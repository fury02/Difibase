import Blob "mo:base/Blob";
import Hex "mo:encoding/Hex";
import Text "mo:base/Text";

import SHA256 "../src/SHA/SHA256";

let sum256 = SHA256.sum(Blob.toArray(Text.encodeUtf8("hello world\n")));
assert(Hex.encode(sum256) == "A948904F2F0F479B8F8197694B30184B0D2ED1C1CD2A1EC0FB85D299A192A447");

let h = SHA256.New();
h.write(Blob.toArray(Text.encodeUtf8("hello world\n")));
assert(Hex.encode(sum256) == Hex.encode(h.sum([])));

for (v in [
    ("", "E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B855"),
    ("a", "CA978112CA1BBDCAFAC231B39A23DC4DA786EFF8147C4E72B9807785AFEE48BB"),
    ("ab", "FB8E20FC2E4C3F248C60C39BD652F3C1347298BB977B8B4D5903B85055620603"),
    ("abc", "BA7816BF8F01CFEA414140DE5DAE2223B00361A396177A9CB410FF61F20015AD"),
    ("abcd", "88D4266FD4E6338D13B845FCF289579D209C897823B9217DA3E161936F031589"),
    ("abcde", "36BBE50ED96841D10443BCB670D6554F0A34B761BE67EC9C4A8AD2C0C44CA42C"),
    ("abcdef", "BEF57EC7F53A6D40BEB640A780A639C83BC29AC8A9816F1FC6C5C6DCD93C4721"),
    ("abcdefg", "7D1A54127B222502F5B79B5FB0803061152A44F92B37E23C6527BAF665D4DA9A"),
    ("abcdefgh", "9C56CC51B374C3BA189210D5B6D4BF57790D351C96C47C02190ECF1E430635AB"),
    ("abcdefghi", "19CC02F26DF43CC571BC9ED7B0C4D29224A3EC229529221725EF76D021C8326F"),
    ("abcdefghij", "72399361DA6A7754FEC986DCA5B7CBAF1C810A28DED4ABAF56B2106D06CB78B0"),
].vals()) {
    assert(Hex.encode(SHA256.sum(Blob.toArray(Text.encodeUtf8(v.0)))) == v.1);
};

do {
    let h = SHA256.New();
    h.write(Blob.toArray(Text.encodeUtf8("hello")));
    h.write(Blob.toArray(Text.encodeUtf8(" ")));
    h.write(Blob.toArray(Text.encodeUtf8("world")));
    assert(Hex.encode(h.sum([])) == "B94D27B9934D3E08A52E52D7DA7DABFAC484EFE37A5380EE9088F7ACE2EFCDE9");
};
